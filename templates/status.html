{% extends "base.html" %}

{% block title %}שינוי סטטוס{% endblock %}

{% block content %}
  <div class="card" style="max-width:800px;margin:0 auto;">

    <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:14px;">
      <div>
        <h1 style="margin:0;">שינוי סטטוס</h1>
        <div class="helper" style="margin-top:6px;">
          מסך אדמין, רק אדמין מעדכן סטטוס
        </div>
      </div>

      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
        <a class="btn btn-secondary" href="/">בחירת דיזיין</a>
        <span class="status">
          דיזיין נוכחי
          {% if theme_name == "enterprise" %}
            1
          {% elif theme_name == "soft" %}
            2
          {% elif theme_name == "pro" %}
            3
          {% elif theme_name == "mobile" %}
            4
          {% else %}
            1
          {% endif %}
        </span>
      </div>
    </div>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="helper" style="margin-bottom:12px;color:var(--warning);">
          {{ messages[0] }}
        </div>
      {% endif %}
    {% endwith %}

    <form method="post" action="/status/{{ appointment.id }}">
      <input type="hidden" name="next" value="{{ back_url }}">

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;">

        <div>
          <label class="label">נושא</label>
          <input class="input" type="text" value="{{ appointment.title }}" readonly style="opacity:0.85;">
        </div>

        <div>
          <label class="label">בעלים</label>
          <input class="input" type="text" value="{{ appointment.owner_email }}" readonly style="opacity:0.85;">
        </div>

        <div>
          <label class="label">תאריך</label>
          <input class="input" type="text" value="{{ appointment.date }}" readonly style="opacity:0.85;">
        </div>

        <div>
          <label class="label">שעה</label>
          <input class="input" type="text" value="{{ appointment.time }}" readonly style="opacity:0.85;">
        </div>

        <div style="grid-column:1 / -1;">
          <label class="label">מיקום</label>
          <input class="input" type="text" value="{{ appointment.location }}" readonly style="opacity:0.85;">
        </div>

        <div style="grid-column:1 / -1;">
          <label class="label">הערות</label>
          <textarea class="input" readonly style="opacity:0.85;min-height:120px;resize:vertical;">{{ appointment.notes }}</textarea>
        </div>

        <div>
          <label class="label">עדכון סטטוס אחרון</label>
          <input class="input" type="text" value="{{ appointment.status_updated_at_text }}" readonly style="opacity:0.85;">
        </div>

        <div>
          <label class="label">עודכן על ידי</label>
          <input class="input" type="text" value="{{ appointment.status_updated_by_email }}" readonly style="opacity:0.85;">
        </div>

        <div style="grid-column:1 / -1;">
          <label class="label">סטטוס חדש</label>
          <select class="input" name="status" required style="height:46px;">
            <option value="planned" {% if appointment.status == 'planned' %}selected{% endif %}>מתוכנן</option>
            <option value="done" {% if appointment.status == 'done' %}selected{% endif %}>הושלם</option>
            <option value="canceled" {% if appointment.status == 'canceled' %}selected{% endif %}>בוטל</option>
          </select>
        </div>

      </div>

      <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:18px;">
        <button class="btn btn-primary" type="submit">שמור סטטוס</button>
        <a class="btn btn-secondary" href="{{ back_url }}">חזרה</a>
      </div>

    </form>
  </div>
{% endblock %}
